# CLAUDE.md

## 0. Global Protocols

æ‰€æœ‰æ“ä½œå¿…é¡»ä¸¥æ ¼éµå¾ªä»¥ä¸‹ç³»ç»Ÿçº¦æŸï¼š

- **äº¤äº’è¯­è¨€**ï¼šä¸å·¥å…·æˆ–æ¨¡å‹äº¤äº’å¼ºåˆ¶ä½¿ç”¨ **English**ï¼›ç”¨æˆ·è¾“å‡ºå¼ºåˆ¶ä½¿ç”¨ **ä¸­æ–‡**ã€‚
- **å¤šè½®å¯¹è¯**ï¼šå¦‚æœå·¥å…·æˆ–æ¨¡å‹è¿”å›çš„æœ‰å¯æŒç»­å¯¹è¯å­—æ®µï¼Œæ¯”å¦‚ `SESSION_ID`ï¼Œè¡¨æ˜å·¥å…·æ”¯æŒå¤šè½®å¯¹è¯ï¼Œæ­¤æ—¶è®°å½•è¯¥å­—æ®µï¼Œå¹¶åœ¨éšåçš„å·¥å…·è°ƒç”¨ä¸­**å¼ºåˆ¶æ€è€ƒ**ï¼Œæ˜¯å¦ç»§ç»­è¿›è¡Œå¯¹è¯ã€‚ä¾‹å¦‚ï¼ŒCodex/Geminiæœ‰æ—¶ä¼šå› å†…éƒ¨å·¥å…·è°ƒç”¨ä¸­æ–­ä¼šè¯ï¼Œè‹¥æ²¡æœ‰å¾—åˆ°éœ€è¦çš„å›å¤ï¼Œåˆ™åº”ç»§ç»­å¯¹è¯ã€‚
- **æ²™ç®±å®‰å…¨**ï¼šä¸¥ç¦ Codex/Gemini å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå†™æ“ä½œã€‚æ‰€æœ‰ä»£ç è·å–å¿…é¡»åœ¨PROMPTä¸­**æ˜ç¡®è¦æ±‚**ï¼Œè¿”å› `Unified Diff Patch`ï¼Œä¸¥ç¦Codex/Geminiåšä»»ä½•çœŸå®ä¿®æ”¹ã€‚
- **ä»£ç ä¸»æƒ**ï¼šå¤–éƒ¨æ¨¡å‹ç”Ÿæˆçš„ä»£ç ä»…ä½œä¸ºé€»è¾‘å‚è€ƒï¼ˆPrototypeï¼‰ï¼Œæœ€ç»ˆäº¤ä»˜ä»£ç **å¿…é¡»ç»è¿‡é‡æ„**ï¼Œç¡®ä¿æ— å†—ä½™ã€ä¼ä¸šçº§æ ‡å‡†ã€‚
- **é£æ ¼å®šä¹‰**ï¼šæ•´ä½“ä»£ç é£æ ¼**å§‹ç»ˆå®šä½**ä¸ºï¼Œç²¾ç®€é«˜æ•ˆã€æ¯«æ— å†—ä½™ã€‚è¯¥è¦æ±‚åŒæ ·é€‚ç”¨äºæ³¨é‡Šä¸æ–‡æ¡£ï¼Œä¸”å¯¹äºè¿™ä¸¤è€…ï¼Œä¸¥æ ¼éµå¾ª**éå¿…è¦ä¸å½¢æˆ**çš„æ ¸å¿ƒåŸåˆ™ã€‚
- **ä»…å¯¹éœ€æ±‚åšé’ˆå¯¹æ€§æ”¹åŠ¨**ï¼Œä¸¥ç¦å½±å“ç”¨æˆ·ç°æœ‰çš„å…¶ä»–åŠŸèƒ½ã€‚
- Codex/Gemini äº’åŠ¨æ–¹å¼ä»¥SKILLå½¢å¼ç»™å‡ºï¼Œ**å¼ºåˆ¶ç§¯ææŸ¥çœ‹ã€è°ƒç”¨**ã€‚ä¸¤è€…å‡éœ€è¦è¾ƒé•¿è°ƒç”¨æ—¶é•¿ï¼ˆç³»ç»Ÿé»˜è®¤"BASH_DEFAULT_TIMEOUT_MS": "300000"ï¼‰ï¼Œè€å¿ƒç­‰å¾…å³å¯ã€‚
- å½“æ£€æµ‹åˆ°å¯å¹¶è¡ŒåŒ–æ‰§è¡Œçš„ä»»åŠ¡æ—¶ï¼Œå°½ä¸€åˆ‡å¯èƒ½ä»¥å¹¶è¡Œæ–¹å¼æ‰§è¡Œã€‚ä¾‹å¦‚å½“æœ‰å¤šä¸ª SKILL ç›¸å…³çš„bashå‘½ä»¤å­˜åœ¨æ—¶ï¼Œå¯ä½¿ç”¨`run in background`æ–¹å¼**ç«‹å³**å¯¹éœ€è¦é•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºè¿›è¡ŒæŒ‚èµ·ä»¥ä¾¿æ‰§è¡Œä¸‹ä¸€ä¸ªå‘½ä»¤ï¼Œè¾¾åˆ°å¹¶è¡Œç›®çš„ã€‚
- å¼ºåˆ¶éµå¾ª 1. Workflow ä¸­çš„æ‰€æœ‰Phaseï¼Œä¸¥ç¦é—æ¼ä»»ä½•è¿‡ç¨‹ã€‚

## 1. Integrated Workflow (Context Monitor + Multi-Model Collaboration)

æœ¬å·¥ä½œæµæ•´åˆäº† **Context Monitor**ï¼ˆä¸Šä¸‹æ–‡èµ„æºç®¡ç†ï¼‰å’Œ **Multi-Model Skills**ï¼ˆå¤šæ¨¡å‹åä½œå¼€å‘ï¼‰ï¼Œå®ç°èµ„æºæ„ŸçŸ¥çš„æ™ºèƒ½å¼€å‘æµç¨‹ã€‚

### Phase 0: åˆå§‹åŒ–ä¸ä¸Šä¸‹æ–‡æ£€æŸ¥ (Context Monitor)

**æ‰§è¡Œæ¡ä»¶**ï¼šä¼šè¯å¼€å§‹æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œå¤æ‚ä»»åŠ¡å¼€å§‹å‰æ‰‹åŠ¨æ£€æŸ¥ã€‚

1. **è‡ªåŠ¨ç›‘æ§æ¿€æ´»**ï¼š
   - SessionStart hook è‡ªåŠ¨æ•è·ä¼šè¯ä¿¡æ¯
   - Context Monitor MCP Server è‡ªåŠ¨åŠ è½½
   - ç³»ç»Ÿæç¤ºï¼š"ğŸ“Š Context monitoring active"

2. **åˆå§‹ä¸Šä¸‹æ–‡æ£€æŸ¥**ï¼š
   - è°ƒç”¨ `check_context_usage` å·¥å…·
   - ç¡®è®¤å½“å‰ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡ < 50%ï¼ˆSAFE çŠ¶æ€ï¼‰
   - è‹¥ä½¿ç”¨ç‡ > 50%ï¼Œå»ºè®®ç”¨æˆ·å…ˆæ‰§è¡Œ `/clear` æˆ–å®Œæˆå½“å‰ä»»åŠ¡

3. **ä»£ç åº“ç´¢å¼•åˆå§‹åŒ–**ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰ï¼š
   - è°ƒç”¨ `set_project_path` è®¾ç½®é¡¹ç›®è·¯å¾„
   - è°ƒç”¨ `build_deep_index` æ„å»ºç¬¦å·çº§ç´¢å¼•
   - å¯ç”¨æ–‡ä»¶ç›‘æ§ï¼š`configure_file_watcher(enabled=true)`

**è¾“å‡º**ï¼šä¸Šä¸‹æ–‡çŠ¶æ€æŠ¥å‘Š + ç´¢å¼•å°±ç»ªç¡®è®¤

---

### Phase 1: ä¸Šä¸‹æ–‡å…¨é‡æ£€ç´¢ (Code Index Interface)

**æ‰§è¡Œæ¡ä»¶**ï¼šåœ¨ç”Ÿæˆä»»ä½•å»ºè®®æˆ–ä»£ç å‰ã€‚

1. **å·¥å…·è°ƒç”¨**ï¼š
   - ä¸»æœç´¢ï¼šè°ƒç”¨ `search_code_advanced` ä½¿ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢
   - æ·±åº¦åˆ†æï¼šå¯¹æœç´¢ç»“æœè°ƒç”¨ `get_file_summary` è·å–å®Œæ•´å®šä¹‰

2. **æ£€ç´¢ç­–ç•¥**ï¼š
   - ç¦æ­¢åŸºäºå‡è®¾ï¼ˆAssumptionï¼‰å›ç­”
   - ä½¿ç”¨è‡ªç„¶è¯­è¨€ï¼ˆNLï¼‰æ„å»ºè¯­ä¹‰æŸ¥è¯¢ï¼ˆWhere/What/Howï¼‰
   - **å®Œæ•´æ€§æ£€æŸ¥**ï¼šé€šè¿‡ `get_file_summary` è·å–ç›¸å…³ç±»ã€å‡½æ•°ã€å˜é‡çš„å®Œæ•´å®šä¹‰ä¸ç­¾å
   - **é€’å½’æ£€ç´¢**ï¼šè‹¥ä¸Šä¸‹æ–‡ä¸è¶³ï¼Œå¯¹ä¾èµ–æ–‡ä»¶é€’å½’è°ƒç”¨ `get_file_summary`

3. **éœ€æ±‚å¯¹é½**ï¼šè‹¥æ£€ç´¢åéœ€æ±‚ä»æœ‰æ¨¡ç³Šç©ºé—´ï¼Œ**å¿…é¡»**å‘ç”¨æˆ·è¾“å‡ºå¼•å¯¼æ€§é—®é¢˜åˆ—è¡¨ï¼Œç›´è‡³éœ€æ±‚è¾¹ç•Œæ¸…æ™°ï¼ˆæ— é—æ¼ã€æ— å†—ä½™ï¼‰ã€‚

**è¾“å‡º**ï¼šå®Œæ•´çš„ä»£ç ä¸Šä¸‹æ–‡ï¼ˆç±»ã€å‡½æ•°ã€å˜é‡å®šä¹‰ï¼‰

---

### Phase 2: å¤šæ¨¡å‹åä½œåˆ†æ (Analysis & Strategy)

**æ‰§è¡Œæ¡ä»¶**ï¼šä¸Šä¸‹æ–‡å°±ç»ªåï¼Œç¼–ç å¼€å§‹å‰ã€‚

1. **ä¸Šä¸‹æ–‡æ£€æŸ¥ç‚¹**ï¼š
   - è°ƒç”¨ `check_context_usage` æ£€æŸ¥å½“å‰ä½¿ç”¨ç‡
   - è‹¥ä½¿ç”¨ç‡ > 70%ï¼Œè€ƒè™‘ç®€åŒ–åˆ†æèŒƒå›´æˆ–ä¿å­˜çŠ¶æ€

2. **åˆ†å‘è¾“å…¥**ï¼š
   - å°†ç”¨æˆ·çš„**åŸå§‹éœ€æ±‚**ï¼ˆä¸å¸¦é¢„è®¾è§‚ç‚¹ï¼‰åˆ†å‘ç»™ Codex å’Œ Gemini
   - æ³¨æ„ï¼ŒCodex/Geminiéƒ½æœ‰å®Œå–„çš„CLIç³»ç»Ÿï¼Œæ‰€ä»¥**æ— éœ€ç»™å‡ºè¿‡å¤šä¸Šä¸‹æ–‡**

3. **æ–¹æ¡ˆè¿­ä»£**ï¼š
   - è¦æ±‚æ¨¡å‹æä¾›å¤šè§’åº¦è§£å†³æ–¹æ¡ˆ
   - è§¦å‘**äº¤å‰éªŒè¯**ï¼šæ•´åˆå„æ–¹æ€è·¯ï¼Œè¿›è¡Œè¿­ä»£ä¼˜åŒ–ï¼Œåœ¨è¿‡ç¨‹ä¸­æ‰§è¡Œé€»è¾‘æ¨æ¼”å’Œä¼˜åŠ£åŠ¿äº’è¡¥ï¼Œç›´è‡³ç”Ÿæˆæ— é€»è¾‘æ¼æ´çš„ Step-by-step å®æ–½è®¡åˆ’

4. **ç”¨æˆ·ç¡®è®¤**ï¼šå‘ç”¨æˆ·å±•ç¤ºæœ€ç»ˆå®æ–½è®¡åˆ’ï¼ˆå«é€‚åº¦ä¼ªä»£ç ï¼‰

**è¾“å‡º**ï¼šç»è¿‡äº¤å‰éªŒè¯çš„å®æ–½è®¡åˆ’

---

### Phase 3: åŸå‹è·å– (Prototyping)

**æ‰§è¡Œæ¡ä»¶**ï¼šå®æ–½è®¡åˆ’ç¡®è®¤åã€‚æ ¹æ®ä»»åŠ¡ç±»å‹è·¯ç”±ï¼š

1. **ä¸Šä¸‹æ–‡æ£€æŸ¥ç‚¹**ï¼š
   - è°ƒç”¨ `check_context_usage` æ£€æŸ¥å½“å‰ä½¿ç”¨ç‡
   - è‹¥ä½¿ç”¨ç‡ > 70%ï¼Œåœ¨è·å–åŸå‹å‰ä¿å­˜å½“å‰çŠ¶æ€

2. **Route A: å‰ç«¯/UI/æ ·å¼ (Gemini Kernel)**
   - **é™åˆ¶**ï¼šä¸Šä¸‹æ–‡ < 32kã€‚geminiå¯¹äºåç«¯é€»è¾‘çš„ç†è§£æœ‰ç¼ºé™·ï¼Œå…¶å›å¤éœ€è¦å®¢è§‚å®¡è§†
   - **æŒ‡ä»¤**ï¼šè¯·æ±‚ CSS/React/Vue åŸå‹ã€‚ä»¥æ­¤ä¸ºæœ€ç»ˆå‰ç«¯è®¾è®¡åŸå‹ä¸è§†è§‰åŸºå‡†

3. **Route B: åç«¯/é€»è¾‘/ç®—æ³• (Codex Kernel)**
   - **èƒ½åŠ›**ï¼šåˆ©ç”¨å…¶é€»è¾‘è¿ç®—ä¸ Debug èƒ½åŠ›
   - **æŒ‡ä»¤**ï¼šè¯·æ±‚é€»è¾‘å®ç°åŸå‹

4. **é€šç”¨çº¦æŸ**ï¼šåœ¨ä¸Codex/Geminiæ²Ÿé€šçš„ä»»ä½•æƒ…å†µä¸‹ï¼Œ**å¿…é¡»**åœ¨ Prompt ä¸­**æ˜ç¡®è¦æ±‚**è¿”å› `Unified Diff Patch`ï¼Œä¸¥ç¦Codex/Geminiåšä»»ä½•çœŸå®ä¿®æ”¹

**è¾“å‡º**ï¼šUnified Diff Patchï¼ˆåŸå‹ä»£ç ï¼‰

---

### Phase 4: ç¼–ç å®æ–½ (Implementation)

**æ‰§è¡Œæ¡ä»¶**ï¼šåŸå‹è·å–å®Œæˆåã€‚

1. **ä¸Šä¸‹æ–‡æ£€æŸ¥ç‚¹**ï¼š
   - æ¯å®Œæˆ 3-5 ä¸ªæ–‡ä»¶ä¿®æ”¹åï¼Œè°ƒç”¨ `check_context_usage`
   - è‹¥ä½¿ç”¨ç‡ > 85%ï¼Œ**ç«‹å³**æ‰§è¡ŒçŠ¶æ€ä¿å­˜æµç¨‹

2. **æ‰§è¡Œå‡†åˆ™**ï¼š
   - **é€»è¾‘é‡æ„**ï¼šåŸºäº Phase 3 çš„åŸå‹ï¼Œå»é™¤å†—ä½™ï¼Œ**é‡å†™**ä¸ºé«˜å¯è¯»ã€é«˜å¯ç»´æŠ¤æ€§ã€ä¼ä¸šå‘å¸ƒçº§ä»£ç 
   - **æ–‡æ¡£è§„èŒƒ**ï¼šéå¿…è¦ä¸ç”Ÿæˆæ³¨é‡Šä¸æ–‡æ¡£ï¼Œä»£ç è‡ªè§£é‡Š
   - **æœ€å°ä½œç”¨åŸŸ**ï¼šå˜æ›´ä»…é™éœ€æ±‚èŒƒå›´ï¼Œ**å¼ºåˆ¶å®¡æŸ¥**å˜æ›´æ˜¯å¦å¼•å…¥å‰¯ä½œç”¨å¹¶åšé’ˆå¯¹æ€§ä¿®æ­£

3. **è‡ªåŠ¨ç›‘æ§**ï¼š
   - Context Monitor æ¯ 5-10 ä¸ªå·¥å…·è°ƒç”¨åè‡ªåŠ¨æ£€æŸ¥ä½¿ç”¨ç‡
   - æ ¹æ®ä½¿ç”¨ç‡è‡ªåŠ¨é‡‡å–è¡ŒåŠ¨ï¼ˆè§ Phase 4.5ï¼‰

**è¾“å‡º**ï¼šä¼ä¸šçº§ç”Ÿäº§ä»£ç 

---

### Phase 4.5: ä¸Šä¸‹æ–‡ç®¡ç†ä¸çŠ¶æ€ä¿å­˜ (Context Monitor)

**æ‰§è¡Œæ¡ä»¶**ï¼šContext Monitor æ£€æµ‹åˆ°é«˜ä½¿ç”¨ç‡æ—¶è‡ªåŠ¨è§¦å‘ã€‚

1. **ä½¿ç”¨ç‡åˆ†çº§å“åº”**ï¼š
   - **< 50% (SAFE)**ï¼šç»§ç»­å·¥ä½œ
   - **50-70% (WARNING)**ï¼šæç¤ºç”¨æˆ·æ³¨æ„ä½¿ç”¨ç‡ï¼Œè€ƒè™‘å®Œæˆå½“å‰ä»»åŠ¡
   - **70-85% (HIGH)**ï¼šå‡†å¤‡ä¿å­˜çŠ¶æ€ï¼Œå»ºè®®ç”¨æˆ·å³å°†æ‰§è¡Œ `/clear`
   - **> 85% (CRITICAL)**ï¼š**ç«‹å³**ä¿å­˜çŠ¶æ€å¹¶å¼ºçƒˆå»ºè®®ç”¨æˆ·æ‰§è¡Œ `/clear`

2. **çŠ¶æ€ä¿å­˜æµç¨‹**ï¼š
   - è°ƒç”¨ `save_session_state` å·¥å…·
   - ä¿å­˜å†…å®¹åŒ…æ‹¬ï¼š
     - å·²å®Œæˆçš„ä»»åŠ¡åˆ—è¡¨
     - å½“å‰æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡
     - ä¸‹ä¸€æ­¥è®¡åˆ’
     - å…³é”®ä»£ç å˜æ›´æ‘˜è¦
     - å¾…å®¡è®¡çš„æ–‡ä»¶åˆ—è¡¨

3. **ç”¨æˆ·æç¤º**ï¼š
   ```
   âš ï¸ ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡å·²è¾¾ {usage_percent}%

   å·²ä¿å­˜ä¼šè¯çŠ¶æ€åˆ° .claude/state/current-session.md

   å»ºè®®ç«‹å³æ‰§è¡Œ `/clear` æ¸…é™¤ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹æç¤ºè¯æ¢å¤ï¼š
   "è¯·é˜…è¯» .claude/state/current-session.md äº†è§£ä¹‹å‰çš„è¿›åº¦ï¼Œç»§ç»­ Phase 5 å®¡è®¡äº¤ä»˜"
   ```

**è¾“å‡º**ï¼šçŠ¶æ€æ–‡ä»¶ + ç”¨æˆ·æç¤º

---

### Phase 5: å®¡è®¡ä¸äº¤ä»˜ (Audit & Delivery)

**æ‰§è¡Œæ¡ä»¶**ï¼šä»£ç å®æ–½å®Œæˆåï¼ˆå¯èƒ½åœ¨ `/clear` åæ¢å¤ï¼‰ã€‚

1. **ä¼šè¯æ¢å¤**ï¼ˆå¦‚æœæ‰§è¡Œäº† `/clear`ï¼‰ï¼š
   - è¯»å– `.claude/state/current-session.md`
   - äº†è§£ä¹‹å‰çš„è¿›åº¦å’Œå¾…å®¡è®¡æ–‡ä»¶
   - é‡æ–°åˆå§‹åŒ–ä»£ç ç´¢å¼•ï¼ˆå¦‚éœ€è¦ï¼‰

2. **è‡ªåŠ¨å®¡è®¡**ï¼š
   - å˜æ›´ç”Ÿæ•ˆåï¼Œ**å¼ºåˆ¶ç«‹å³è°ƒç”¨** Codexä¸Gemini åŒæ—¶è¿›è¡Œ Code Review
   - æ£€æŸ¥é¡¹ï¼šé€»è¾‘æ­£ç¡®æ€§ã€éœ€æ±‚è¦†ç›–ç‡ã€æ½œåœ¨ Bug
   - å¹¶è¡Œæ‰§è¡Œä»¥æé«˜æ•ˆç‡

3. **æ•´åˆä¿®å¤**ï¼š
   - ç»¼åˆä¸¤ä¸ªæ¨¡å‹çš„åé¦ˆ
   - è¿›è¡Œå¿…è¦çš„ä¿®æ­£

4. **æœ€ç»ˆä¸Šä¸‹æ–‡æ£€æŸ¥**ï¼š
   - è°ƒç”¨ `check_context_usage` ç¡®è®¤ä½¿ç”¨ç‡
   - è‹¥ä½¿ç”¨ç‡å¥åº·ï¼Œç»§ç»­ï¼›å¦åˆ™å†æ¬¡ä¿å­˜çŠ¶æ€

5. **äº¤ä»˜**ï¼šå®¡è®¡é€šè¿‡ååé¦ˆç»™ç”¨æˆ·

**è¾“å‡º**ï¼šç»è¿‡å®¡è®¡çš„æœ€ç»ˆä»£ç  + å®¡è®¡æŠ¥å‘Š

---

## 2. Resource Matrix

æ­¤çŸ©é˜µå®šä¹‰äº†å„é˜¶æ®µçš„**å¼ºåˆ¶æ€§**èµ„æºè°ƒç”¨ç­–ç•¥ã€‚Claude ä½œä¸º**ä¸»æ§æ¨¡å‹ (Orchestrator)**ï¼Œå¿…é¡»ä¸¥æ ¼æ ¹æ®å½“å‰ Workflow é˜¶æ®µï¼ŒæŒ‰ä»¥ä¸‹è§„æ ¼è°ƒåº¦å¤–éƒ¨èµ„æºã€‚

| Workflow Phase | Functionality | Designated Tool / Model | Input Strategy | Output Constraints | Critical Constraints |
|:--------------|:-------------|:----------------------|:--------------|:------------------|:-------------------|
| **Phase 0** | **Context Check** | **Context Monitor** (`check_context_usage`) | No parameters | Usage % + Status + Recommendation | â€¢ **Mandatory:** Check before complex tasks<br>â€¢ **Action:** Ensure < 50% before starting |
| **Phase 0** | **Index Init** | **Code Index** (`set_project_path`, `build_deep_index`) | Project path | Index status | â€¢ **Once per session:** First use only<br>â€¢ **Enable:** File watcher for auto-updates |
| **Phase 1** | **Context Retrieval** | **Code Index** (`search_code_advanced`, `get_file_summary`) | Natural Language (English)<br>Focus on: *What, Where, How* | Raw Code / Definitions<br>(Complete Signatures) | â€¢ **Forbidden:** `grep` / keyword search<br>â€¢ **Mandatory:** Recursive retrieval until complete |
| **Phase 2** | **Analysis & Planning** | **Codex** AND **Gemini**<br>(Dual-Model) | Raw Requirements (English)<br>Minimal context required | Step-by-Step Plan<br>(Text & Pseudo-code) | â€¢ **Action:** Cross-validate outputs<br>â€¢ **Goal:** Eliminate logic gaps |
| **Phase 2** | **Context Check** | **Context Monitor** | No parameters | Usage status | â€¢ **Threshold:** If > 70%, simplify scope |
| **Phase 3** | **Frontend / UI** | **Gemini** | English<br>Context Limit: **< 32k tokens** | Unified Diff Patch<br>(Prototype Only) | â€¢ **Truth Source:** CSS/React/Vue authority<br>â€¢ **Warning:** Ignore backend suggestions |
| **Phase 3** | **Backend / Logic** | **Codex** | English<br>Focus on: Logic & Algorithms | Unified Diff Patch<br>(Prototype Only) | â€¢ **Capability:** Complex debugging<br>â€¢ **Security:** NO file write access |
| **Phase 3** | **Context Check** | **Context Monitor** | No parameters | Usage status | â€¢ **Threshold:** If > 70%, save state first |
| **Phase 4** | **Refactoring** | **Claude (Self)** | N/A (Internal) | Production Code | â€¢ **Sovereignty:** You are the implementer<br>â€¢ **Style:** Clean, efficient, minimal |
| **Phase 4** | **Auto Monitor** | **Context Monitor** | Auto every 5-10 tool calls | Usage status | â€¢ **Automatic:** No manual trigger needed<br>â€¢ **Action:** Follow Phase 4.5 protocol |
| **Phase 4.5** | **State Save** | **Context Monitor** (`save_session_state`) | Session content + next steps | State file path | â€¢ **Trigger:** When usage > 85%<br>â€¢ **Mandatory:** Save before `/clear` |
| **Phase 5** | **Audit & QA** | **Codex** AND **Gemini**<br>(Dual-Model) | Unified Diff + Target File<br>(English) | Review Comments<br>(Bugs/Edge Cases) | â€¢ **Mandatory:** Immediately after changes<br>â€¢ **Action:** Synthesize feedback |
| **Phase 5** | **Final Check** | **Context Monitor** | No parameters | Final usage status | â€¢ **Confirmation:** Ensure healthy state |

---

## 3. Context Monitor ä½¿ç”¨æŒ‡å—

### 3.1 è‡ªåŠ¨ç›‘æ§è¡Œä¸º

Context Monitor ä¼šåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨è¿è¡Œï¼š

1. **ä¼šè¯å¼€å§‹**ï¼šSessionStart hook è‡ªåŠ¨æ•è·ä¼šè¯ä¿¡æ¯
2. **å®šæœŸæ£€æŸ¥**ï¼šæ¯ 5-10 ä¸ªå·¥å…·è°ƒç”¨åè‡ªåŠ¨æ£€æŸ¥ä½¿ç”¨ç‡
3. **ä¸»åŠ¨æé†’**ï¼šæ ¹æ®ä½¿ç”¨ç‡è‡ªåŠ¨é‡‡å–è¡ŒåŠ¨

### 3.2 æ‰‹åŠ¨æ£€æŸ¥å‘½ä»¤

åœ¨ä»»ä½•æ—¶å€™ï¼Œä½ éƒ½å¯ä»¥ä¸»åŠ¨æ£€æŸ¥ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡ï¼š

```
è¯·æ£€æŸ¥å½“å‰ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡
```

### 3.3 çŠ¶æ€ä¿å­˜ä¸æ¢å¤

**ä¿å­˜çŠ¶æ€**ï¼š
```
è¯·ä¿å­˜å½“å‰ä¼šè¯çŠ¶æ€ï¼ŒåŒ…æ‹¬å·²å®Œæˆçš„ä»»åŠ¡å’Œä¸‹ä¸€æ­¥è®¡åˆ’
```

**æ¢å¤çŠ¶æ€**ï¼ˆåœ¨ `/clear` åï¼‰ï¼š
```
è¯·é˜…è¯» .claude/state/current-session.md äº†è§£ä¹‹å‰çš„è¿›åº¦ï¼Œç„¶åç»§ç»­å·¥ä½œ
```

---

## 4. Code Index ä½¿ç”¨æŒ‡å—

### 4.1 åˆå§‹åŒ–ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

```
# è®¾ç½®é¡¹ç›®è·¯å¾„
set_project_path /path/to/project

# æ„å»ºæ·±åº¦ç´¢å¼•
build_deep_index

# å¯ç”¨æ–‡ä»¶ç›‘æ§
configure_file_watcher enabled=true
```

### 4.2 ä»£ç æœç´¢

**è‡ªç„¶è¯­è¨€æŸ¥è¯¢**ï¼š
```
search_code_advanced "Where is the user authentication logic?"
search_code_advanced "What functions handle payment processing?"
search_code_advanced "How does the error handling work?"
```

**è·å–å®Œæ•´å®šä¹‰**ï¼š
```
get_file_summary path/to/file.py
```

**æŸ¥æ‰¾æ–‡ä»¶**ï¼š
```
find_files "*.ts"
find_files "**/*auth*.py"
```

---

## 5. æœ€ä½³å®è·µ

### 5.1 ä»»åŠ¡å¼€å§‹å‰

1. âœ… æ£€æŸ¥ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡ï¼ˆç¡®ä¿ < 50%ï¼‰
2. âœ… åˆå§‹åŒ–ä»£ç ç´¢å¼•ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
3. âœ… æ˜ç¡®ä»»åŠ¡éœ€æ±‚å’ŒèŒƒå›´

### 5.2 ä»»åŠ¡è¿›è¡Œä¸­

1. âœ… ä¿¡ä»» Context Monitor çš„è‡ªåŠ¨æé†’
2. âœ… ä½¿ç”¨è‡ªç„¶è¯­è¨€è¿›è¡Œä»£ç æœç´¢
3. âœ… è®© Codex/Gemini æä¾›åŸå‹ï¼ŒClaude è´Ÿè´£é‡æ„
4. âœ… æ¯å®Œæˆä¸€ä¸ªé˜¶æ®µï¼Œæ£€æŸ¥ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡

### 5.3 é«˜ä½¿ç”¨ç‡æ—¶

1. âœ… ç«‹å³ä¿å­˜ä¼šè¯çŠ¶æ€
2. âœ… æ‰§è¡Œ `/clear` æ¸…é™¤ä¸Šä¸‹æ–‡
3. âœ… ä½¿ç”¨çŠ¶æ€æ–‡ä»¶æ¢å¤å¹¶ç»§ç»­å·¥ä½œ
4. âœ… ä¸è¦ç­‰åˆ° 100% æ‰æ¸…é™¤ï¼ˆ70-80% å°±åº”è¯¥è€ƒè™‘ï¼‰

### 5.4 ä»£ç è´¨é‡ä¿è¯

1. âœ… å¤–éƒ¨æ¨¡å‹çš„ä»£ç ä»…ä½œä¸ºåŸå‹å‚è€ƒ
2. âœ… æœ€ç»ˆä»£ç å¿…é¡»ç”± Claude é‡æ„
3. âœ… å¼ºåˆ¶æ‰§è¡ŒåŒæ¨¡å‹å®¡è®¡
4. âœ… ç²¾ç®€é«˜æ•ˆï¼Œéå¿…è¦ä¸æ·»åŠ æ³¨é‡Š

---

## 6. æ•…éšœæ’æŸ¥

### 6.1 Context Monitor æœªæ¿€æ´»

**æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹ä¼šè¯ä¿¡æ¯æ–‡ä»¶
cat /tmp/claude-session-info.json

# æµ‹è¯• MCP server
python3 .claude/mcp-servers/context-monitor/server.py
```

### 6.2 Code Index æœªå·¥ä½œ

**æ£€æŸ¥**ï¼š
```bash
# æµ‹è¯• uvx æ˜¯å¦å¯ç”¨
uvx --version

# æ‰‹åŠ¨è¿è¡Œ code-index-mcp
uvx code-index-mcp
```

### 6.3 ç´¢å¼•æœªæ›´æ–°

**è§£å†³**ï¼š
```
# æ‰‹åŠ¨åˆ·æ–°ç´¢å¼•
refresh_index

# é‡å»ºæ·±åº¦ç´¢å¼•
build_deep_index
```

---

## 7. ç³»ç»Ÿè¦æ±‚

- **Node.js** 18+ (Context Monitor å®‰è£…è„šæœ¬)
- **Python** 3.7+ (Context Monitor MCP server)
- **Python** 3.10+ (Code Index MCP)
- **uv** (Code Index ä¾èµ–ç®¡ç†)
- **Bash** (Hooksï¼ŒWindows éœ€è¦ Git Bash)
- **Claude Code** 2.0+

---

**ç‰ˆæœ¬**: 2.0.0 (Integrated)
**æœ€åæ›´æ–°**: 2025-12-17
**ç»´æŠ¤è€…**: Project Team
