---
description: 自动执行完整工作流（一键完成所有阶段）
---

# 自动化工作流

自动执行完整的 Context Monitor 工作流，在关键决策点暂停确认。

## 执行流程

### 🔄 Phase 0-1: 准备阶段（自动）

1. **检查上下文使用率**
   - 调用 `check_context_usage` 工具
   - 如果使用率 > 70%，先保存状态并建议 `/clear`
   - 确认使用率健康后继续

2. **初始化代码索引**（如需要）
   - 自动检测是否已初始化
   - 如未初始化，自动调用 `set_project_path` 和 `build_deep_index`

3. **搜索相关代码**
   - 根据任务描述自动搜索相关代码
   - 使用 `search_code_advanced` 进行语义搜索
   - 获取完整的代码上下文

### ⏸️ Phase 2: 分析阶段（暂停确认）

4. **多模型协作分析**
   - 并行调用 Codex 和 Gemini 分析任务
   - 交叉验证两个模型的输出
   - 生成统一的实施方案

5. **展示实施方案**
   - 显示技术方案、潜在风险、实施步骤
   - **等待用户确认**：继续 / 修改方案 / 取消

### 🔄 Phase 3-4: 实施阶段（自动）

6. **获取原型代码**
   - 根据确认的方案，调用合适的模型生成原型
   - 前端任务 → Gemini
   - 后端任务 → Codex

7. **重构为生产代码**
   - 基于原型重构为企业级代码
   - 自动监控上下文使用率
   - 如使用率 > 70%，自动保存状态

### ⏸️ Phase 5: 审计阶段（暂停确认）

8. **双模型代码审计**
   - 并行调用 Codex 和 Gemini 审计代码
   - 识别潜在问题、安全漏洞、性能问题
   - 生成审计报告

9. **展示审计结果**
   - 显示发现的问题和建议
   - **等待用户确认**：应用修复 / 忽略 / 手动修改

### ✅ 最终交付

10. **完成工作流**
    - 应用必要的修复
    - 最终检查上下文使用率
    - 输出完成报告

## 优势

- ✅ **一个命令完成所有步骤** - 无需记忆 6 个阶段
- ✅ **在关键点暂停确认** - 保持人工控制
- ✅ **自动化上下文管理** - 无需手动检查
- ✅ **并行执行提升性能** - 多模型调用并行化
- ✅ **降低学习成本** - 新用户友好

## 使用方法

```bash
# 基本用法
/cm:auto 实现用户认证功能

# 带详细描述
/cm:auto 添加 JWT 认证，支持 token 刷新和权限验证
```

## 与手动模式对比

| 特性 | 手动模式 | 自动模式 |
|------|---------|---------|
| 命令数量 | 6 个 | 1 个 |
| 学习成本 | 高 | 低 |
| 控制粒度 | 细粒度 | 关键点 |
| 适用场景 | 复杂任务 | 常规任务 |
| 上下文管理 | 手动 | 自动 |

## 注意事项

- 自动模式会在 Phase 2 和 Phase 5 暂停等待确认
- 如果任务特别复杂，建议使用手动模式以获得更多控制
- 上下文使用率会自动监控，无需手动检查

**ARGUMENTS**: $1
