---
description: 保存会话状态（Phase 4.5）
---

# 保存会话状态

执行 Phase 4.5：上下文管理与状态保存

## 执行步骤

1. **检查上下文使用率**
   - 调用 `check_context_usage` 工具
   - 获取当前使用率

2. **评估状态**
   - < 50% (SAFE)：继续工作
   - 50-70% (WARNING)：提示用户注意使用率
   - 70-85% (HIGH)：准备保存状态
   - > 85% (CRITICAL)：立即保存状态

3. **保存状态** (带降级方案)
   - **主方案**: 调用 `save_session_state` MCP 工具 (超时 5 秒)
   - **降级方案**: 如 MCP 失败，直接使用 Write 工具写入
   - 保存内容：
     * 已完成任务
     * 当前任务
     * 下一步计划
     * 代码变更摘要
     * 待审计文件
   - 保存路径: `.claude/state/current-session.md`

4. **用户提示**
   - 显示状态文件路径
   - 建议执行 `/clear` 清除上下文
   - 提供恢复提示词

**输出**：会话状态文件 + 恢复指令
